<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- For IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Resposive Device -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- For Window Tab Color -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#2c2c2c">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#2c2c2c">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#2c2c2c">

    <title>Blog</title>
    <link rel="shortcut icon" th:href="@{/static/images/logo/favicon.ico}" type="image/x-icon" />
    <!-- Main style sheet -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <!-- responsive style sheet -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/responsive.css}">
    <!-- Theme-Color css -->
    <link rel="stylesheet" id="jssDefault" th:href="@{/css/color.css}">
    <link id="linkstyle" rel='stylesheet' th:href="@{/css/markdown.css}"/>


    <!-- Fix Internet Explorer ______________________________________-->

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <script th:src="@{/vendor/html5shiv.js}"></script>
    <script th:src="@{/vendor/respond.js}"></script>
    <![endif]-->


</head>

<body>

<div class="main-page-wrapper">
    <!-- ===================================================
        Loading Transition
    ==================================================== -->
    <div id="loader-wrapper">
        <div id="loader">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <!-- ===================================================
        About Me Wrapper
    ==================================================== -->
    <div id="blogdetail" class="user-blog">
        <div class="back-to-home fixed"><a href="/"><i class="flaticon-left-arrow"></i> HOME</a></div>
        <div class="main-text-wrapper">
            <div class="container">
                <div style="padding-top: 55px">
                    <h2 align="center" style="word-break: break-word" th:text="${blog.title}"></h2>
                    <div class="md-content" th:utext="${blog.content}"></div>
                    <p class="content-update" th:utext="'<i class=\'fas fa-history\'></i>  '+${#dates.format(blog.updateTime,'yyyy.MM.dd HH:mm')} + ' .updated'"></p>
                </div>
                <div class="comment-area">
                    <div class="comment-area-head">
                        <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" color=#dc3545 SIZE=3>
                        <h3><strong>评论区</strong></h3>
                    </div>
                    <div class="comment-meta" style="margin-top: 20px" th:each="comment:${comments}">
                        <div class="single-comment">
                            <div class="comment">
                                <h6>
                                    <div>
                                        <a th:text="${comment.commenter}"></a>
                                    </div>
                                    <div>
                                        <i class="date" th:text="${#dates.format(comment.createTime,'yyyy-MM-dd HH:mm')}" ></i>
                                    </div>
                                </h6>

                                <p th:utext="${comment.comment}"></p>
                                <button class="reply">回复</button>
                                <div class="comment-form">
                                    <form method="post" class="comment-form-validation" autocomplete="off">
                                        <input type="text" required="true" placeholder="Name*" name="commenter">
                                        <input type="text" placeholder="Email" name="commenterEmail">
                                        <p><textarea required="true" placeholder="内容" name="comment"></textarea></p>
                                        <input type="text" hidden name="blogId" th:value="${blog.id}">
                                        <input type="text" hidden name="replyTo" th:value="${comment.commenter}">
                                        <input type="text" hidden name="parentId" th:value="${comment.id}">
                                        <button type="button" class="theme-button-one"
                                                onclick="javascript:sendComment(this,false)"
                                                style="margin-bottom: 20px">提交
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <div class="reply-comment" th:each="childComment:${comment.comments}">
                                <h6>
                                    <div>
                                        <a th:text="${childComment.commenter}"></a>
                                    </div>
                                    <div>
                                        <i class="date" th:text="${#dates.format(childComment.createTime,'yyyy-MM-dd HH:mm')}" ></i>
                                    </div>
                                </h6>
                                <p th:utext=" (${childComment.replyTo == ''} ? '' : '<strong>@' + ${childComment.replyTo} + '</strong>  ')  + ${childComment.comment}"></p>
                                <button class="reply">回复</button>
                                <div class="comment-form">
                                    <form method="post" class="comment-form-validation" autocomplete="off">
                                        <input type="text" required="true" placeholder="Name*" name="commenter">
                                        <input type="text" placeholder="Email" name="commenterEmail">
                                        <input type="text" hidden name="blogId" th:value="${blog.id}">
                                        <input type="text" hidden name="replyTo" th:value="${childComment.commenter}">
                                        <input type="text" hidden name="parentId" th:value="${comment.id}">
                                        <p><textarea required="true" placeholder="内容" name="comment"></textarea></p>
                                        <button type="button" class="theme-button-one"
                                                onclick="javascript:sendComment(this,false)"
                                                style="margin-bottom: 20px">提交
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="comment-bottom-area">
                    <HR style="FILTER: progid:DXImageTransform.Microsoft.Glow(color=#dc3545,strength=10)" color=#dc3545
                        SIZE=3>
                    <h3><strong>留下你的评论</strong></h3>
                    <div class="comment-form-bottom" style="margin-top: 20px">
                        <form method="post" class="comment-form-validation" autocomplete="off">
                            <br/>
                            <input type="text" required="true" placeholder="Name*" name="commenter">
                            <br/>
                            <input type="text" placeholder="Email" name="commenterEmail">
                            <input type="text" hidden name="blogId" th:value="${blog.id}">
                            <input type="text" hidden name="replyTo" value="">
                            <input type="text" hidden name="parentId" value="0">
                            <br/>
                            <p><textarea required="true" placeholder="500字以内评论" name="comment"></textarea></p>
                            <button type="button" class="theme-button-one" onclick="javascript:sendComment(this,true)"
                                    style="margin-bottom: 20px">Post Comment
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div> <!-- /.main-text-wrapper -->
        <!--Contact Form Validation Markup -->
        <!-- Contact alert -->
        <div class="alert-wrapper" id="alert-success">
            <div id="success">
                <button class="closeAlert"><i class="fas fa-window-close"></i></button>
                <div class="wrapper">
                    <p>Your message was sent successfully.</p>
                </div>
            </div>
        </div> <!-- End of .alert_wrapper -->
        <div class="alert-wrapper" id="alert-error">
            <div id="error">
                <button class="closeAlert"><i class="fas fa-window-close"></i></button>
                <div class="wrapper">
                    <p>Sorry!Something Went Wrong.</p>
                </div>
            </div>
        </div> <!-- End of .alert_wrapper -->
    </div> <!-- /.contact-us -->
    <button class="scroll-top tran3s">
        <i class="fa fa-angle-up" aria-hidden="true"></i>
    </button>
    <!-- Optional JavaScript _____________________________  -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- jQuery -->
    <script th:src="@{/vendor/jquery.2.2.3.min.js}"></script>
    <!-- Popper js -->
    <script th:src="@{/vendor/popper.js/popper.min.js}"></script>
    <!-- Bootstrap JS -->
    <script th:src="@{/vendor/bootstrap/js/bootstrap.min.js}"></script>
    <!-- Style-switcher  -->
    <script th:src="@{/vendor/jQuery.style.switcher.min.js}"></script>
    <!-- jquery-easy-ticker-master -->
    <script th:src="@{/vendor/jquery-easy-ticker-master/jquery.easy-ticker.min.js}"></script>
    <!-- jquery easing -->
    <script th:src="@{/vendor/jquery.easing.1.3.js}"></script>
    <!-- Font Awesome -->
    <script th:src="@{/fonts/font-awesome/fontawesome-all.min.js}"></script>
    <!-- Validation -->
    <script type="text/javascript" th:src="@{/vendor/contact-form/validate.js}"></script>
    <script type="text/javascript" th:src="@{/vendor/contact-form/jquery.form.js}"></script>

    <!-- Theme js -->
    <script th:src="@{/js/theme.min.js}"></script>
</div> <!-- /.main-page-wrapper -->
<script type="text/javascript">
    $(document).ready(function () {
        $(".reply").click(function () {
            $(this).parent().find(".comment-form").toggle(500, function () {
            })
        });
    });

    function sendComment(obj, isComment) {
        var form = new FormData(obj.parentNode);
        var checkResult = true;
        $(obj.parentNode).find("[required='true']").each(function () {
            if ($(this).val().trim() == '') {
                $(this).focus();
                checkResult = false;
                return;
            }
            var arrtName = $(this).attr('name');
            if (arrtName == 'comment' && $(this).val().trim().length > 500) {
                $(this).focus();
                checkResult = false;
                return;
            }
        });
        if (isComment) {
            form.set('replyTo', '');
        }
        if (checkResult) {
            setCookie('commenter',form.get('commenter'),'d30');
            setCookie('commenterEmail',form.get('commenterEmail'),'d30');
            $.ajax({
                url: "/comment/sendComment",
                type: "post",
                data: form,
                processData: false,
                contentType: false,
                success: function (data) {
                    var commentDiv = $(obj).parent().parent().parent();
                    if (!isComment) {
                        var appendHtml =
                            '<h6><div><a>' + form.get('commenter') + '</a></div><div><i class="date" >'+ new Date().Format("yyyy-MM-dd HH:mm") +'</i></div></h6>\n' +
                            '   <p><strong>@' + form.get('replyTo') + '</strong> ' + form.get('comment') + '</p>\n' +
                            '   <button class="reply">回复</button>\n' +
                            '   <div class="comment-form">\n' +
                            '   <form method="post" class="comment-form-validation" autocomplete="off">\n' +
                            '       <input type="text" required="true" placeholder="Name*" name="commenter" value="'+ form.get('commenter') +'">\n' +
                            '       <input type="text" placeholder="Email" name="commenterEmail" value="'+ form.get('commenterEmail') +'" >\n' +
                            '       <input type="text" hidden name="blogId" value="' + form.get('blogId') + '">\n' +
                            '       <input type="text" hidden name="replyTo" th:value="' + form.get('replyTo') + '">\n' +
                            '       <input type="text" hidden name="parentId" th:value="' + form.get('parentId') + '">\n' +
                            '       <p><textarea  required="true" placeholder="500字以内评论" name="comment"></textarea></p>\n' +
                            '       <button type="button"  class="theme-button-one" onclick="javascript:sendComment(this,false)"   style="margin-bottom: 20px">提交</button>\n' +
                            '   </form>\n' +
                            ' </div>';
                        var finalAppendHtml = '<div class="reply-comment">' + appendHtml + '</div>';
                        $(commentDiv).parent().append($(finalAppendHtml));
                    } else {
                        var ht =
                            '  <div class="single-comment" >\n' +
                            '    <div class="comment">\n' +
                            '    <h6><div><a>' + form.get('commenter') + '</a></div><div><i class="date" >'+ new Date().Format("yyyy-MM-dd HH:mm") + '</i></div></h6>\n' +
                            '    <p >' + form.get('comment') + '</p>\n' +
                            '    <button class="reply">回复</button>\n' +
                            '    <div class="comment-form">\n' +
                            '        <form method="post" class="comment-form-validation" autocomplete="off">\n' +
                            '            <input type="text" required="true" placeholder="Name*" name="commenter" value="'+ form.get('commenter') +'" >\n' +
                            '            <input type="text" placeholder="Email" name="commenterEmail" value="'+ form.get('commenterEmail') +'">\n' +
                            '            <p><textarea required="true" placeholder="500字以内评论" name="comment"></textarea></p>\n' +
                            '            <input type="text" hidden name="blogId" value="' + form.get('blogId') + '">\n' +
                            '            <input type="text" hidden name="replyTo" value="' + form.get('commenter') + '">\n' +
                            '            <input type="text" hidden name="parentId" vaue="0">\n' +
                            '            <button type="button"  class="theme-button-one" onclick="javascript:sendComment(this,false)"    style="margin-bottom: 20px">提交</button>\n' +
                            '        </form>\n' +
                            '    </div>\n' +
                            '  </div>';
                        var finalHt = '<div class="comment-meta">' + ht + '</div>';
                        $('.comment-area').append($(finalHt));
                    }
                    if (!isComment) {
                        $(obj).parent().parent().toggle(500, function () {
                        });
                        obj.parentNode.reset();
                    } else {
                        $('.comment-bottom-area').find("textarea").val('');
                    }
                    if ($(".reply").length > 0) {
                        $(".reply").each(function () {
                            if (!$._data(this, 'events')) {
                                $(this).on('click', function () {
                                    $(this).parent().find(".comment-form").toggle(500, function () {
                                    })
                                });
                            }
                        });
                    }
                },
                error: function (e) {
                }
            });
        }

    }
</script>
</body>
</html>
